<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>منصة أعمال ومبادرات ثانوية اليعقوبي بالخبر</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  /* أبعاد الهيدر المرجعية من تصميمك: 2048×478 ≈ 4.28:1 */
  --heroW:2048; --heroH:478;

  --ink:#0e3134; --muted:#5f7280; --line:#e7eff0;
  --paper:#fff; --bg:#f3f7f7; --accent:#0a8a7a;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--ink);font-family:"Tajawal",system-ui,sans-serif}
a{color:inherit;text-decoration:none}
.container{max-width:calc(var(--heroW) * 1px); margin-inline:auto; padding:0 10px}

/* الهيدر */
.hero{width:100%; aspect-ratio: var(--heroW) / var(--heroH); position:relative; overflow:hidden; border-radius:10px}
.hero img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover; display:block; user-select:none; -webkit-user-drag:none}

/* عامة للأقسام */
.section{background:var(--paper); border:1px solid var(--line); border-radius:18px; padding:16px; box-shadow:0 12px 28px rgba(0,0,0,.04)}
.section h2{margin:0 0 10px; font-size:clamp(18px,2vw,22px); color:#0a4a46; display:flex; align-items:center; gap:10px}
.section h2 .tag{margin-inline-start:auto; background:#ebf5f4; color:#0a4a46; padding:3px 10px; border-radius:999px; font-size:12px}

/* صف منصات + مبادراتي */
.row-plat-init{display:grid; gap:12px; margin:12px 0; grid-template-columns:2fr 1fr}
@media (max-width:1100px){ .row-plat-init{grid-template-columns:1fr} }

/* منصات */
.toolbar{display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom:10px}
.chip{border:1px solid var(--line); border-radius:999px; padding:6px 10px; font-size:13px; background:#f5fbfb; color:#0a5c58; cursor:pointer}
.chip.active{background:linear-gradient(90deg,#e8fbf5,#e9f6ff); border-color:#cfeae6}
.search{position:relative; flex:1; min-width:200px}
.search input{width:100%; border:1px solid var(--line); background:#fbfefe; padding:10px 12px; border-radius:12px; font-size:14px}
.cards{display:grid; grid-template-columns:repeat(3,1fr); gap:12px}
@media (max-width:1100px){ .cards{grid-template-columns:repeat(2,1fr)} }
@media (max-width:640px){ .cards{grid-template-columns:1fr} }

.card{
  background:linear-gradient(180deg,#ffffff,#f8fcfc);
  border:1px solid var(--line); border-radius:14px; padding:14px;
  display:grid; grid-template-columns:1fr auto; gap:8px; align-items:start;
  transition:transform .15s ease, box-shadow .2s ease;
}
.card:hover{transform:translateY(-2px); box-shadow:0 10px 22px rgba(0,0,0,.06)}
.card .title{font-weight:800; color:#064a45; font-size:15px}
.card .desc{grid-column:1 / -1; font-size:13px; color:#5f7280}
.badges{display:flex; gap:6px; flex-wrap:wrap}
.badge{font-size:11px; padding:3px 8px; border-radius:999px; border:1px solid var(--line); background:#f5fbfb; color:#0a5a56}
.actions{display:flex; gap:8px}
.btn{border:1px solid var(--line); background:#fff; padding:7px 10px; border-radius:10px; font-weight:700; font-size:12px}
.btn:hover{background:#f2faf8}
.btn.whatsapp{color:#0f8e59; border-color:#cfeadf}

/* الأدلّة والأنظمة */
.columns{display:grid; grid-template-columns:1fr 1fr; gap:12px; margin:12px 0}
@media (max-width:900px){ .columns{grid-template-columns:1fr} }

/* مبادراتي (قائمة مفردة) */
.list{display:grid; grid-template-columns:1fr; gap:12px}

/* لوحة الإدارة (مودال) */
.modal-back{position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; place-items:center; z-index:50; padding:10px}
.modal{width:min(860px,96vw); background:#fff; border-radius:14px; border:1px solid var(--line); box-shadow:0 20px 60px rgba(0,0,0,.25)}
.modal header{padding:12px 14px; border-bottom:1px solid var(--line); display:flex; align-items:center; gap:8px}
.modal header h3{margin:0; font-size:16px}
.modal .body{padding:12px 14px; max-height:min(70vh,700px); overflow:auto}
.modal .grid2{display:grid; grid-template-columns:1fr 1fr; gap:10px}
.modal label{font-size:12px; color:#335}
.modal input[type=text], .modal textarea, .modal select{
  width:100%; border:1px solid var(--line); border-radius:10px; padding:8px 10px; font-family:inherit; font-size:14px; background:#fbfefe;
}
.modal textarea{min-height:80px; resize:vertical}
.modal .row{display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:8px}
.modal footer{padding:10px 14px; border-top:1px solid var(--line); display:flex; justify-content:space-between; gap:8px}
.kbd{background:#eef4f3; border:1px solid #d7e7e4; padding:0 6px; border-radius:6px; font-size:12px}

/* التذييل الصغير */
.footer{background:linear-gradient(90deg,#0e6462,#2f7f79); color:#e8fffb; text-align:center; padding:8px 10px; border-radius:14px; margin:16px 0; font-size:12px}
.footer b{color:#fff}
</style>
</head>
<body>

<div class="container">

  <!-- الهيدر بصورة واحدة بنسبة ثابتة لمنع التشوّه -->
  <header class="hero" aria-label="هيدر المنصة">
    <img src="logo.png" alt="منصة أعمال ومبادرات ثانوية اليعقوبي بالخبر">
  </header>

  <!-- صف: منصات + مبادراتي -->
  <div class="row-plat-init">

    <!-- منصات ومواقع تعليمية -->
    <section class="section" id="platforms">
      <h2>منصات ومواقع تعليمية <span class="tag" id="countP"></span></h2>
      <div class="toolbar">
        <button class="chip active" data-filter="all">الكل</button>
        <button class="chip" data-filter="وزارة">وزارة</button>
        <button class="chip" data-filter="تعلم">تعلم</button>
        <button class="chip" data-filter="دخول">دخول</button>
        <div class="search"><input id="platformSearch" placeholder="ابحث باسم المنصة أو الوصف…"></div>
        <button id="btnEditPlatforms" class="btn" title="تحرير قائمة المنصات">⚙️ تحرير المنصات</button>
      </div>
      <div class="cards" id="platformGrid"></div>
    </section>

    <!-- مبادراتي -->
    <section class="section" id="initiatives">
      <h2>مبادراتي</h2>
      <div class="list" id="initList"></div>
    </section>

  </div>

  <!-- الأدلّة والأنظمة -->
  <section class="section" id="docs">
    <h2>
      الأدلّة والأنظمة
      <span class="tag">عمودان ٧ + ٧</span>
      <button id="btnManageDocs" class="btn" style="margin-inline-start:auto">⚙️ إدارة الأدلّة</button>
    </h2>
    <div class="columns" id="docsCols"></div>
  </section>

  <!-- التذييل -->
  <div class="footer">
    <b>تنفيذ وتجميع:</b> فهد حامد الزهراني — منصة داخلية تربط أدوات التطوير والتعليم والإدارة في منظومة واحدة.
  </div>
</div>

<!-- مودال إدارة الأدلّة -->
<div class="modal-back" id="docsModalBack" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="docsModalTitle">
    <header>
      <h3 id="docsModalTitle">إدارة الأدلّة والأنظمة</h3>
      <span class="kbd">PIN</span> ١٤٤٧
    </header>
    <div class="body">
      <div class="row">
        <button class="btn" id="addDoc">➕ إضافة دليل</button>
        <button class="btn" id="resetDocs">♻️ تصفير (العودة للمبدئي)</button>
      </div>
      <div id="docsListAdmin" style="margin-top:10px"></div>
      <hr>
      <div class="grid2">
        <div>
          <label>العنوان</label>
          <input type="text" id="docTitle">
        </div>
        <div>
          <label>النوع</label>
          <select id="docKind">
            <option>دليل</option><option>لائحة</option><option>قواعد</option><option>آلية</option><option>نموذج</option>
          </select>
        </div>
      </div>
      <div class="row">
        <div style="flex:1">
          <label>الرابط (إن وجد)</label>
          <input type="text" id="docUrl" placeholder="https://…">
        </div>
        <div>
          <label>أو ارفع PDF</label><br>
          <input type="file" id="docFile" accept="application/pdf">
        </div>
      </div>
      <div style="margin-top:8px">
        <label>وصف مختصر</label>
        <textarea id="docDesc" placeholder="ملخص موجز للدليل…"></textarea>
      </div>
    </div>
    <footer>
      <div class="row">
        <button class="btn" id="saveDoc">💾 حفظ/تحديث</button>
        <button class="btn" id="cancelDoc">إلغاء</button>
      </div>
      <div class="row">
        <span style="font-size:12px;color:#6b7">ملاحظة: ملفات PDF تُحفظ محليًا في المتصفح (Data URL). لا تُرفع لخادم.</span>
      </div>
    </footer>
  </div>
</div>

<!-- مودال تحرير المنصات -->
<div class="modal-back" id="platModalBack" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="platModalTitle">
    <header>
      <h3 id="platModalTitle">تحرير قائمة المنصات والمواقع</h3>
      <span class="kbd">JSON</span>
    </header>
    <div class="body">
      <p style="margin:4px 0 8px; color:#456; font-size:13px">
        عدّل العناصر بصيغة JSON (الحقول: <b>name</b>, <b>desc</b>, <b>url</b>, <b>tags</b>).
      </p>
      <textarea id="platEditor" style="width:100%; min-height:320px; border:1px solid var(--line); border-radius:10px; padding:10px; font-family:ui-monospace,mono; font-size:13px"></textarea>
    </div>
    <footer>
      <div class="row">
        <button class="btn" id="savePlat">💾 حفظ</button>
        <button class="btn" id="resetPlat">♻️ تصفير للقائمة المبدئية</button>
        <button class="btn" id="cancelPlat">إغلاق</button>
      </div>
      <span style="font-size:12px;color:#6b7">تُحفظ القائمة محليًا تحت المفتاح platforms_custom_v1</span>
    </footer>
  </div>
</div>

<script>
/* ================= مفاتيح التخزين ================= */
const ADMIN_PIN = "1447";
const KEY_DOCS = "docs_custom_v1";
const KEY_PLAT = "platforms_custom_v1";

/* ================= المنصات (من الملف + تحسينات) ================= */
const PLATFORMS_DEFAULT = [
  {name:"الدعم الموحّد (IAM)", desc:"نظام النفاذ الموحّد لبوابات وزارة التعليم", url:"https://iam.moe.gov.sa/", tags:["وزارة","دخول"]},
  {name:"مدرستي", desc:"منصة المدرسة للتعليم الإلكتروني", url:"https://schools.madrasati.sa/", tags:["تعلم"]},
  {name:"نور", desc:"نظام إدارة معلومات الطالب", url:"https://noor.moe.gov.sa/Noor/login.aspx", tags:["وزارة","دخول"]},
  {name:"قناة عين", desc:"البث التعليمي ومكتبة الفيديو", url:"http://www.ientv.edu.sa/", tags:["تعلم"]},
  {name:"حضوري", desc:"إثبات الحضور والانصراف", url:"https://hather-ui.moe.gov.sa/dashboard", tags:["وزارة","دخول"]},
  {name:"فارس", desc:"الخدمة الذاتية لمنسوبي التعليم", url:"https://sshr.moe.gov.sa/", tags:["وزارة","دخول"]},
  {name:"منصة نيوبد (FutureX)", desc:"برامج التطوير المهني الرقمي", url:"https://niepd.futurex.sa/", tags:["تعلم"]},
  {name:"Outlook", desc:"البريد المؤسسي", url:"https://outlook.office.com/mail/", tags:["دخول"]},
  {name:"خدماتي", desc:"بوابة خدمات التعليم", url:"https://khadamati.moe.gov.sa/sp", tags:["وزارة"]},
  /* يمكنك إضافة/حذف إدارات تعليم هنا أو من محرر JSON */
  {name:"إدارة تعليم الشرقية", desc:"الموقع الرسمي لإدارة تعليم الشرقية", url:"https://www.edueast.gov.sa/", tags:["وزارة"]},
  {name:"إدارة تعليم الرياض", desc:"الموقع الرسمي لإدارة تعليم الرياض", url:"https://www.riyadhedu.gov.sa/", tags:["وزارة"]},
  {name:"إدارة تعليم مكة", desc:"الموقع الرسمي لإدارة تعليم مكة", url:"https://edu.moe.gov.sa/makkah/", tags:["وزارة"]}
];

/* ================= الأدلّة والأنظمة (14 عنصرًا) =================
   تم ملء الروابط وفق ترتيب الروابط في ملف PDF الذي زوّدته.
   يمكنك تغيير أي رابط لاحقًا من لوحة الإدارة.
*/
const DOCS_DEFAULT = [
  {title:"الدليل التنظيمي لمدارس التعليم العام", kind:"دليل",
   url:"https://drive.google.com/file/d/1E604s0Wni9ht-UnfaB4ywlN55YyjW9Wj/view?usp=sharing",
   desc:"مرجع يوضّح مهام وصلاحيات المدرسة وهيكلها الإداري."},
  {title:"الدليل الإجرائي لمدارس التعليم العام", kind:"دليل",
   url:"https://drive.google.com/file/d/18rVycmGYJ3vNrUq2hsAbZiDGv9WaZULR/view?usp=sharing",
   desc:"خطوات العمل والإجراءات التفصيلية للمهام المدرسية."},
  {title:"لائحة تقويم الطالب 2025م", kind:"لائحة",
   url:"https://drive.google.com/file/d/1jMcFdltw6SomgRAGyFQFOecvJOqF4m8-/view?usp=sharing",
   desc:"أساليب وأدوات وضوابط التقويم لرفع نواتج التعلّم."},
  {title:"الإجراءات التنفيذية للائحة تقويم الطالب 2025م", kind:"دليل",
   url:"https://drive.google.com/file/d/1FP2_l_4vTqbuBK7k03YktLX92TVdqDcy/view?usp=sharing",
   desc:"آليات تطبيق اللائحة داخل المدرسة."},
  {title:"قواعد السلوك والمواظبة 1447هـ", kind:"قواعد",
   url:"https://drive.google.com/file/d/1L5GiafAgPY0vBSQdea_obk9vKcE-t7JR/view?usp=sharing",
   desc:"حقوق وواجبات الطالب وضوابط الإجراءات التربوية."},
  {title:"آلية تنفيذ النشاط الطلابي 1447هـ", kind:"آلية",
   url:"https://drive.google.com/file/d/1RYIYPFlAcT9Ya-RnPw3bnpQASVQIz0FX/view?usp=sharing",
   desc:"تفعيل البرامج وفق دليل الخطط الدراسية."},
  {title:"الدليل الإرشادي لمشرف دعم التميز", kind:"دليل",
   url:"https://drive.google.com/file/d/1ak9uHKDbi8cPecgYzV8_cIqv2-NlmOR_/view?usp=sharing",
   desc:"تمكين المشرف من دعم التميز والجودة."},
  {title:"توزيع درجات الطلاب 2025م", kind:"لائحة",
   url:"https://drive.google.com/file/d/1aJfnmDnFuvE5STTsZ6PIGeMJLfYG0Xcl/view?usp=sharing",
   desc:"آلية احتساب الدرجات بين الاختبارات وأعمال الفصل."},
  {title:"دليل الاختبارات 2025م", kind:"دليل",
   url:"https://drive.google.com/file/d/1igqY7tNeqoEPX7YV6VqTw0GnGUWDzBNf/view?usp=sharing",
   desc:"الأسس الفنية والتنظيمية لتنفيذ الاختبارات."},
  {title:"دليل خدمة الجدول المدرسي 2025م", kind:"دليل",
   url:"https://drive.google.com/file/d/1XAMG04koxiH2pd8jfVwgFTYKvGX_JqHf/view?usp=sharing",
   desc:"إعداد وإدارة الجداول إلكترونيًا."},
  {title:"دليل الزي المدرسي والرياضي لطلبة التعليم العام", kind:"دليل",
   url:"https://drive.google.com/file/d/1dJaj5cH6sUOpUh2shay36xH7FctVxZXh/view?usp=sharing",
   desc:"المواصفات المعتمدة للزي بما يعزز الهوية والانضباط."},
  {title:"دليل السلوك المهني لموظفي وزارة التعليم 2025", kind:"دليل",
   url:"https://drive.google.com/file/d/1HbFSJb9wX4i4Bs6YDHrnF2jj8_NwYraq/view?usp=sharing",
   desc:"القيم والمبادئ المهنية لضمان بيئة عمل تربوية."},
  /* الاستبدال المتفق عليه بدل «الأمن الفكري» */
  {title:"استمارة الزيارة الفني لمشرف الإدارة المدرسية", kind:"نموذج",
   url:"https://drive.google.com/file/d/1Q2SnbnnteJCIgyz8WZCESV01Jk_3rPMh/view?usp=sharing",
   desc:"نموذج توثيق الزيارة: معايير، مؤشرات، وتوصيات."},
  {title:"دليل العمل التطوعي", kind:"دليل",
   url:"https://drive.google.com/file/d/17l_qlhdWdUBRWEbDcFKT0iCkUh2gifu4/view?usp=sharing",
   desc:"تنظيم مشاركة الطلاب في التطوع ودعم رؤية 2030."}
];

/* ===== مبادراتي ===== */
const INITIATIVES = [
  {title:"استمارة دعم وتطوير الهيئة التعليمية", url:"https://fhz545-hub.github.io/teachervisit/", note:"توثيق الزيارات الصفّية ونقاط التحسين."},
  {title:"الشؤون الإدارية والمتابعة", url:"https://fhz545-hub.github.io/teacher-eval-1447/", note:"متابعة الانضباط والزيارات الإشرافية."},
  {title:"نموذج تقييم الأداء الوظيفي", url:"https://fhz545-hub.github.io/taqyeem/", note:"التخطيط والمراجعة النصفية والتقييم النهائي."},
  {title:"جدول المدرسة اللحظي", url:"https://fhz545-hub.github.io/jadwal-live/", note:"جداول ومواعيد وتكليفات لحظية."},
  {title:"نموذج تصميم وتنفيذ برنامج/نشاط", url:"https://fhz545-hub.github.io/Report/", note:"خطوات التصميم والتوثيق بالأثر."}
];

/* ============ حالة التخزين المحلي ============ */
let PLATFORMS = JSON.parse(localStorage.getItem(KEY_PLAT) || 'null') || PLATFORMS_DEFAULT;
let DOCS = JSON.parse(localStorage.getItem(KEY_DOCS) || 'null') || DOCS_DEFAULT;

/* ============ توليد واجهة المنصات ============ */
const grid = document.getElementById('platformGrid');
const countP = document.getElementById('countP');
const search = document.getElementById('platformSearch');
const filterChips = [...document.querySelectorAll('.chip')];

function renderPlatforms(){
  const q = (search.value||"").trim().toLowerCase();
  const active = filterChips.find(c=>c.classList.contains('active'))?.dataset.filter || 'all';
  grid.innerHTML = ''; let shown=0;
  PLATFORMS.forEach(p=>{
    const inFilter = (active==='all') || (p.tags||[]).includes(active);
    const inSearch = !q || p.name.toLowerCase().includes(q) || (p.desc||'').toLowerCase().includes(q);
    if(inFilter && inSearch){
      shown++;
      grid.insertAdjacentHTML('beforeend', `
        <article class="card" data-tags="${(p.tags||[]).join(',')}">
          <div>
            <div class="title">${p.name}</div>
            <div class="desc">${p.desc||''}</div>
            <div class="badges">${(p.tags||[]).map(t=>`<span class="badge">${t}</span>`).join('')}</div>
          </div>
          <div class="actions">
            <a class="btn" href="${p.url}" target="_blank" rel="noopener">فتح</a>
          </div>
        </article>
      `);
    }
  });
  countP.textContent = `${shown} رابط`;
}
filterChips.forEach(c=>c.addEventListener('click',()=>{filterChips.forEach(x=>x.classList.remove('active')); c.classList.add('active'); renderPlatforms();}));
search.addEventListener('input', renderPlatforms);
renderPlatforms();

/* ============ توليد واجهة «مبادراتي» ============ */
const initList = document.getElementById('initList');
INITIATIVES.forEach(it=>{
  initList.insertAdjacentHTML('beforeend', `
    <article class="card">
      <div>
        <div class="title">${it.title}</div>
        <div class="desc">${it.note||''}</div>
      </div>
      <div class="actions"><a class="btn" href="${it.url}" target="_blank" rel="noopener">فتح</a></div>
    </article>
  `);
});

/* ============ الأدلّة: عرض + إدارة ============ */
const docsCols = document.getElementById('docsCols');

function linkFor(d){ return d.fileDataUrl ? d.fileDataUrl : (d.url || "#"); }

function renderDocs(){
  docsCols.innerHTML = '';
  const colA = document.createElement('div');
  const colB = document.createElement('div');
  DOCS.forEach((d,i)=>{
    const html = `
      <article class="card">
        <div>
          <div class="title">${d.title}</div>
          <div class="desc">${d.desc||''}</div>
          <div class="badges"><span class="badge">${d.kind||"دليل"}</span></div>
        </div>
        <div class="actions">
          <a class="btn" href="${linkFor(d)}" target="_blank" rel="noopener">فتح</a>
          <a class="btn whatsapp" href="https://wa.me/?text=${encodeURIComponent(d.title + ' — ' + (d.url||location.href))}" target="_blank" rel="noopener">واتساب</a>
        </div>
      </article>`;
    (i<7?colA:colB).insertAdjacentHTML('beforeend', html);
  });
  docsCols.appendChild(colA); docsCols.appendChild(colB);
}
renderDocs();

/* ===== لوحة إدارة الأدلّة ===== */
const Mback = document.getElementById('docsModalBack');
const btnManage = document.getElementById('btnManageDocs');
const listAdmin = document.getElementById('docsListAdmin');
const fTitle = document.getElementById('docTitle');
const fKind  = document.getElementById('docKind');
const fUrl   = document.getElementById('docUrl');
const fFile  = document.getElementById('docFile');
const fDesc  = document.getElementById('docDesc');
const btnAdd = document.getElementById('addDoc');
const btnSave= document.getElementById('saveDoc');
const btnCancel=document.getElementById('cancelDoc');
const btnReset= document.getElementById('resetDocs');
let editIndex = -1;

function adminList(){
  listAdmin.innerHTML = DOCS.map((d,i)=>`
    <div class="card" style="grid-template-columns:1fr auto; align-items:center">
      <div>
        <div class="title">${d.title}</div>
        <div class="desc" style="margin-top:3px">${d.desc||''}</div>
        <div class="badges" style="margin-top:6px">
          <span class="badge">${d.kind||"دليل"}</span>
          ${d.fileDataUrl?`<span class="badge">PDF محلي</span>`:''}
          ${d.url?`<span class="badge">رابط خارجي</span>`:''}
        </div>
      </div>
      <div class="actions">
        <button class="btn" onclick="editDoc(${i})">تعديل</button>
        <button class="btn" onclick="delDoc(${i})">حذف</button>
      </div>
    </div>
  `).join('');
}
function openDocsModal(){
  const ok = sessionStorage.getItem('docs_admin_ok')==='1' || prompt('أدخل رمز الإدارة (PIN)')===ADMIN_PIN;
  if(!ok){return;}
  sessionStorage.setItem('docs_admin_ok','1');
  adminList();
  fTitle.value=fKind.value=fUrl.value=fDesc.value=''; fFile.value=''; editIndex=-1;
  Mback.style.display='grid';
}
function closeDocsModal(){ Mback.style.display='none'; }

btnManage.addEventListener('click', openDocsModal);
btnCancel.addEventListener('click', closeDocsModal);
btnAdd.addEventListener('click', ()=>{ editIndex=-1; fTitle.value=''; fKind.value='دليل'; fUrl.value=''; fFile.value=''; fDesc.value=''; });

btnSave.addEventListener('click', async ()=>{
  const item = {title:fTitle.value.trim(), kind:fKind.value, url:fUrl.value.trim(), desc:fDesc.value.trim()};
  if(!item.title){ alert('العنوان مطلوب'); return; }

  if(fFile.files && fFile.files[0]){
    const file = fFile.files[0];
    if(file.type !== 'application/pdf'){ alert('الرجاء رفع PDF فقط'); return; }
    item.fileDataUrl = await fileToDataUrl(file);
  }

  if(editIndex>=0){ DOCS[editIndex] = {...DOCS[editIndex], ...item}; }
  else{ DOCS.push(item); }

  localStorage.setItem(KEY_DOCS, JSON.stringify(DOCS));
  renderDocs(); adminList();
  fTitle.value=fKind.value=fUrl.value=fDesc.value=''; fFile.value='';
});
btnReset.addEventListener('click', ()=>{
  if(confirm('تأكيد تصفير الأدلّة والعودة للمبدئي؟')) {
    localStorage.removeItem(KEY_DOCS); DOCS=[...DOCS_DEFAULT];
    renderDocs(); adminList();
  }
});
window.editDoc = (i)=>{
  editIndex=i; const d=DOCS[i];
  fTitle.value=d.title||''; fKind.value=d.kind||'دليل'; fUrl.value=d.url||''; fDesc.value=d.desc||''; fFile.value='';
  document.querySelector('#docsModalBack .body').scrollTop=0;
}
window.delDoc = (i)=>{
  if(!confirm('حذف هذا الدليل؟')) return;
  DOCS.splice(i,1); localStorage.setItem(KEY_DOCS, JSON.stringify(DOCS));
  renderDocs(); adminList();
}
function fileToDataUrl(file){ return new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(file); }); }

/* ===== محرّر المنصات (JSON) ===== */
const Pback = document.getElementById('platModalBack');
const btnPlat = document.getElementById('btnEditPlatforms');
const txtPlat = document.getElementById('platEditor');
const btnSavePlat = document.getElementById('savePlat');
const btnResetPlat = document.getElementById('resetPlat');
const btnCancelPlat = document.getElementById('cancelPlat');

btnPlat.addEventListener('click', ()=>{
  txtPlat.value = JSON.stringify(PLATFORMS, null, 2);
  Pback.style.display='grid';
});
btnCancelPlat.addEventListener('click', ()=> Pback.style.display='none');
btnResetPlat.addEventListener('click', ()=>{
  if(confirm('إرجاع قائمة المنصات للوضع المبدئي؟')){
    PLATFORMS = [...PLATFORMS_DEFAULT];
    localStorage.removeItem(KEY_PLAT);
    renderPlatforms();
    txtPlat.value = JSON.stringify(PLATFORMS, null, 2);
  }
});
btnSavePlat.addEventListener('click', ()=>{
  try{
    const parsed = JSON.parse(txtPlat.value);
    if(!Array.isArray(parsed)) throw new Error('يجب أن تكون مصفوفة عناصر');
    PLATFORMS = parsed;
    localStorage.setItem(KEY_PLAT, JSON.stringify(PLATFORMS));
    renderPlatforms();
    Pback.style.display='none';
  }catch(e){ alert('JSON غير صالح:\n' + e.message); }
});

/* إغلاق المودالات عند النقر خارجها */
document.querySelectorAll('.modal-back').forEach(back=>{
  back.addEventListener('click', (e)=>{ if(e.target===back) back.style.display='none'; });
});
</script>
</body>
</html>
