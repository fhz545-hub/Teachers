<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>منصة أعمال ومبادرات ثانوية اليعقوبي بالخبر</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  /* لوحة ألوان تعليمية مستوحاة من MoE */
  --moe-ink:#0b3f43; --moe-main:#0b7e88; --moe-emerald:#0aa58f;
  --bg:#f4f7f7; --paper:#ffffff; --line:#e3ecec; --muted:#5d737a; --ink:#0e3134;
  --brand:#0a8a7a; --brand-2:#0f9b8e; --chip:#eef7f6; --chip-b:#cfeae6;
  --shadow:0 14px 28px rgba(0,0,0,.07);
  --radius:16px; --radius-lg:22px; --radius-sm:12px;
  --pad:14px;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--ink);font-family:"Tajawal",system-ui,sans-serif;}
a{color:inherit;text-decoration:none}
button{font-family:inherit}

/* ===== حاوية عامة ===== */
.container{max-width:1080px;margin-inline:auto;padding:0 14px 18px}
.container::before{content:"";display:block;height:8px;margin:12px 0;background:linear-gradient(90deg,#dff5f1,#f0fbff,#dff5f1);border-radius:999px;filter:brightness(1.05) saturate(1.03)}

/* ===== شريط علوي ثابت (هوية) ===== */
.appbar{position:sticky;top:0;z-index:60;background:linear-gradient(180deg,#ffffff,rgba(255,255,255,.92));backdrop-filter:saturate(1.1) blur(6px);border-bottom:1px solid var(--line)}
.brand{display:flex;align-items:center;gap:10px;padding:10px 14px}
.brand .logo{width:46px;height:46px;border-radius:50%;border:1px solid var(--line);display:grid;place-items:center;background:#fff;overflow:hidden}
.brand .logo img{width:100%;height:100%;object-fit:contain}
.brand .titles{display:flex;flex-direction:column;line-height:1.1}
.brand .titles b{color:var(--moe-ink);font-size:clamp(15px,2.8vw,18px)}
.brand .titles span{color:#3b6368;font-size:12.5px}

/* تبويب أقسام + بحث */
.navbar{display:flex;gap:8px;align-items:center;padding:0 14px 12px;flex-wrap:wrap}
.tab{border:1px solid var(--line);background:#fff;padding:8px 12px;border-radius:999px;font-weight:700;font-size:13px;color:#0a5a56;cursor:pointer}
.tab.active{background:linear-gradient(90deg,#e8fbf5,#e9f6ff);border-color:var(--chip-b)}
.nav-spacer{flex:1}
.search{position:relative;min-width:210px;flex:1}
.search input{width:100%;border:1px solid var(--line);background:#fbfefe;padding:10px 12px;border-radius:12px;font-size:13.5px}
.search .hint{position:absolute;inset-inline-end:8px;top:50%;transform:translateY(-50%);font-size:12px;color:#678}

/* ===== الهيدر المرئي بطلّة الهوية (بدون تشوّه) ===== */
.hero{width:100%;border-radius:var(--radius-lg);overflow:hidden;box-shadow:var(--shadow);background:linear-gradient(120deg,#ebfbf8,#ffffff)}
.hero-inner{display:grid;grid-template-columns:120px 1fr;gap:12px;align-items:center;padding:12px}
@media (max-width:560px){.hero-inner{grid-template-columns:64px 1fr}}
.hero .hero-logo{width:100%;aspect-ratio:1/1;background:#fff;border:1px solid var(--line);border-radius:14px;display:grid;place-items:center;overflow:hidden}
.hero .hero-logo img{width:90%;height:90%;object-fit:contain}
.hero h1{margin:0;font-size:clamp(18px,3.2vw,22px);color:#0a4a46}
.hero p{margin:.25rem 0 0;color:var(--muted);font-size:13.5px}

/* ===== أقسام ===== */
.section{background:var(--paper);border:1px solid var(--line);border-radius:var(--radius);padding:var(--pad);box-shadow:0 10px 24px rgba(0,0,0,.05);position:relative;overflow:hidden}
.section h2{margin:0 0 10px;font-size:clamp(17px,2.3vw,20px);color:#0a4a46;display:flex;align-items:center;gap:10px}
.section h2 .count{font-weight:700;background:#ecf8f6;border:1px solid var(--chip-b);padding:2px 8px;border-radius:999px;color:#0a5a56;font-size:12px}

.row-plat-init{display:grid;gap:14px;margin:14px 0;grid-template-columns:2fr 1fr}
@media (max-width:1100px){.row-plat-init{grid-template-columns:1fr}}

.toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:10px}
.chip{border:1px solid var(--line);border-radius:999px;padding:6px 10px;font-size:13px;background:var(--chip);color:#0a5c58;cursor:pointer}
.chip.active{background:linear-gradient(90deg,#e8fbf5,#e9f6ff);border-color:var(--chip-b)}

.cards{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
@media (max-width:1100px){.cards{grid-template-columns:repeat(2,1fr)}}
@media (max-width:640px){.cards{grid-template-columns:1fr}}
.card{background:linear-gradient(180deg,#ffffff,#f8fcfc);border:1px solid var(--line);border-radius:14px;padding:14px;display:grid;grid-template-columns:1fr auto;gap:8px;align-items:start;transition:transform .15s,box-shadow .2s,background .3s;position:relative;overflow:hidden}
.card::before{content:"";position:absolute;top:-120%;inset-inline:-40%;height:220%;background:linear-gradient(120deg,rgba(255,255,255,0) 0%, rgba(255,255,255,.38) 45%, rgba(255,255,255,0) 60%);transform:translateX(-60%) rotate(10deg);transition:transform .6s;pointer-events:none}
.card:hover{transform:translateY(-2px);box-shadow:0 12px 26px rgba(0,0,0,.07)}
.card:hover::before{transform:translateX(120%) rotate(10deg)}
.card .title{font-weight:800;color:#064a45;font-size:15px}
.card .desc{grid-column:1 / -1;font-size:13.5px;color:var(--muted)}
.badges{display:flex;gap:6px;flex-wrap:wrap}
.badge{font-size:11.5px;padding:3px 8px;border-radius:999px;border:1px solid var(--line);background:#f5fbfb;color:#0a5a56}
.actions{display:flex;gap:8px}
.linkcard{grid-template-columns:1fr;cursor:pointer;position:relative}
.linkcard .desc{grid-column:auto}
.linkcard .actions{display:none}
.btn{border:1px solid var(--line);background:#fff;padding:7px 10px;border-radius:11px;font-weight:700;font-size:12.5px;display:inline-flex;align-items:center;gap:7px;cursor:pointer}
.btn:hover{background:#f2faf8}
.btn.open{color:#0a4a46}
.btn.download{color:#0a6e5f;border-color:#cfeadf}

.columns{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:12px 0}
@media (max-width:1200px){.columns{grid-template-columns:repeat(2,1fr)}}
@media (max-width:700px){.columns{grid-template-columns:1fr}}
.list{display:grid;grid-template-columns:1fr;gap:12px}

/* ===== شريط أدوات جانبي مبتكر (سطح المكتب) + FAB للجوال ===== */
.side-rail{position:fixed;inset-block:auto 24px;inset-inline-end:22px;display:flex;flex-direction:column;gap:10px;z-index:70}
.rail-btn{display:grid;place-items:center;width:46px;height:46px;border-radius:14px;border:1px solid var(--line);background:#fff;box-shadow:var(--shadow);cursor:pointer}
.rail-btn:hover{transform:translateY(-2px)}
@media (max-width:720px){.side-rail{inset-inline:auto;inset-block:auto 16px;left:50%;transform:translateX(-50%);flex-direction:row}
  .rail-btn{width:56px;height:56px;border-radius:18px}
}

/* ===== مودالات محسّنة (Full-sheet على الجوال) ===== */
.modal-back{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;place-items:center;z-index:80;padding:12px}
.modal{width:min(880px,96vw);max-height:min(90vh,820px);background:#fff;border-radius:18px;border:1px solid var(--line);box-shadow:0 20px 60px rgba(0,0,0,.25);display:flex;flex-direction:column}
.modal header{padding:12px 14px;border-bottom:1px solid var(--line);display:flex;align-items:center;gap:8px}
.modal header h3{margin:0;font-size:16px}
.modal .body{padding:12px 14px;overflow:auto}
.modal .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.modal label{font-size:12.5px;color:#335}
.modal input[type=text],.modal textarea,.modal select{width:100%;border:1px solid var(--line);border-radius:10px;padding:9px 11px;font-family:inherit;font-size:13.5px;background:#fbfefe}
.modal textarea{min-height:90px;resize:vertical}
.modal .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px}
.modal footer{padding:10px 14px;border-top:1px solid var(--line);display:flex;justify-content:space-between;gap:10px}
.kbd{background:#eef4f3;border:1px solid #d7e7e4;padding:0 6px;border-radius:6px;font-size:12px}
@media (max-width:640px){.modal{width:100vw;height:92vh;border-radius:18px 18px 0 0;align-self:end}}

/* ===== تذييل ===== */
.footer{background:linear-gradient(90deg,#0e6462,#2f7f79);color:#e8fffb;text-align:center;padding:9px 12px;border-radius:14px;margin:16px 0;font-size:12.5px}
.footer b{color:#fff}

/* طباعة بسيطة وواضحة عند الحاجة */
@media print{
  .appbar,.side-rail,.navbar{display:none !important}
  .container{max-width:100%;padding:0}
  .section{break-inside:avoid}
}
</style>
</head>
<body>

<!-- شريط الهوية الثابت -->
<div class="appbar">
  <div class="brand">
    <div class="logo" aria-hidden="true">
      <img src="logo.png" alt="شعار المدرسة" onerror="this.style.display='none'">
    </div>
    <div class="titles">
      <b>ثانوية اليعقوبي بالخبر</b>
      <span>منصة الأعمال والمبادرات</span>
    </div>
  </div>
  <div class="navbar" role="tablist" aria-label="أقسام المنصة">
    <button class="tab active" data-target="#platforms">المنصات</button>
    <button class="tab" data-target="#initiatives">المبادرات</button>
    <button class="tab" data-target="#docs">الأدلّة والأنظمة</button>
    <div class="nav-spacer"></div>
    <div class="search">
      <input id="globalSearch" placeholder="ابحث في المنصات والأدلّة والمبادرات…" aria-label="بحث عام">
      <span class="hint">⌕</span>
    </div>
  </div>
</div>

<div class="container">
  <!-- هيرو هوية نظيف ومضغوط -->
  <section class="hero" aria-label="هوية المنصة">
    <div class="hero-inner">
      <div class="hero-logo"><img src="logo.png" alt="شعار ثانوية اليعقوبي" onerror="this.style.display='none'"></div>
      <div>
        <h1>منصة أعمال ومبادرات ثانوية اليعقوبي بالخبر</h1>
      </div>
    </div>
  </section>

  <!-- صف: المنصات + المبادرات -->
  <div class="row-plat-init">
    <section class="section" id="platforms">
      <h2>
        منصات ومواقع تعليمية
        <span id="countP" class="count" aria-live="polite"></span>
        <button id="btnEditPlatforms" class="btn" style="margin-inline-start:auto">⚙️ تحرير</button>
      </h2>
      <div class="toolbar">
        <button class="chip active" data-filter="all">الكل</button>
        <button class="chip" data-filter="وزارة">وزارة</button>
        <button class="chip" data-filter="تعلم">تعلم</button>
        <button class="chip" data-filter="دخول">دخول</button>
        <div class="search" style="flex:1;min-width:220px"><input id="platformSearch" placeholder="ابحث باسم المنصة أو الوصف…" aria-label="بحث في المنصات"></div>
      </div>
      <div class="cards" id="platformGrid"></div>
    </section>

    <section class="section" id="initiatives">
      <h2>
        المبادرات
        <span id="countI" class="count"></span>
        <button id="btnEditInit" class="btn" style="margin-inline-start:auto">⚙️ تحرير</button>
      </h2>
      <div class="list" id="initList"></div>
    </section>
  </div>

  <!-- الأدلّة والأنظمة -->
  <section class="section" id="docs">
    <h2>
      الأدلّة والأنظمة
      <span id="countD" class="count"></span>
      <button id="btnManageDocs" class="btn" style="margin-inline-start:auto">⚙️ إدارة الأدلّة</button>
    </h2>
    <div class="columns" id="docsCols"></div>
  </section>

  <div class="footer"><b>تنفيذ وتجميع:</b> فهد حامد الزهراني</div>
</div>

<!-- شريط إجراءات جانبي مبتكر / FAB -->
<div class="side-rail" aria-label="إجراءات سريعة">
  <button class="rail-btn" title="إلى أعلى" id="goTop" aria-label="الرجوع للأعلى">⬆️</button>
  <button class="rail-btn" title="تحرير المنصات" id="goPlat" aria-label="تحرير المنصات">🗂️</button>
  <button class="rail-btn" title="تحرير المبادرات" id="goInit" aria-label="تحرير المبادرات">📝</button>
  <button class="rail-btn" title="إدارة الأدلّة" id="goDocs" aria-label="إدارة الأدلّة">📚</button>
</div>

<!-- مودال الأدلّة -->
<div class="modal-back" id="docsModalBack" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="docsModalTitle">
    <header><h3 id="docsModalTitle">إدارة الأدلّة والأنظمة</h3><span class="kbd">PIN</span> ١٤٤٧</header>
    <div class="body">
      <div class="row">
        <button class="btn" id="addDoc">➕ إضافة دليل</button>
        <button class="btn" id="resetDocs">♻️ تصفير (العودة للمبدئي)</button>
      </div>
      <div id="docsListAdmin" style="margin-top:10px"></div>
      <hr>
      <div class="grid2">
        <div><label>العنوان</label><input type="text" id="docTitle"></div>
        <div><label>النوع</label>
          <select id="docKind">
            <option>دليل</option><option>لائحة</option><option>قواعد</option><option>آلية</option><option>نموذج</option>
          </select>
        </div>
      </div>
      <div class="row">
        <div style="flex:1"><label>الرابط (إن وجد)</label><input type="text" id="docUrl" placeholder="https://…"></div>
        <div><label>أو ارفع PDF</label><br><input type="file" id="docFile" accept="application/pdf"></div>
      </div>
      <div style="margin-top:8px"><label>وصف مختصر</label><textarea id="docDesc" placeholder="ملخص موجز للدليل…"></textarea></div>
    </div>
    <footer>
      <div class="row">
        <button class="btn" id="saveDoc">💾 حفظ/تحديث</button>
        <button class="btn" id="cancelDoc">إغلاق</button>
      </div>
      <div class="row"><span style="font-size:12px;color:#6b7">ملفات PDF تُحفظ محليًا (Data URL).</span></div>
    </footer>
  </div>
</div>

<!-- مودال المنصات -->
<div class="modal-back" id="platModalBack" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="platModalTitle">
    <header><h3 id="platModalTitle">تحرير قائمة المنصات والمواقع</h3><span class="kbd">PIN</span> ١٤٤٧</header>
    <div class="body">
      <p style="margin:4px 0 8px;color:#456;font-size:13px">صيغة JSON: <b>name</b>, <b>desc</b>, <b>url</b>, <b>tags</b>.</p>
      <textarea id="platEditor" style="width:100%;min-height:340px;border:1px solid var(--line);border-radius:10px;padding:10px;font-family:ui-monospace,mono;font-size:13px"></textarea>
    </div>
    <footer>
      <div class="row">
        <button class="btn" id="savePlat">💾 حفظ</button>
        <button class="btn" id="resetPlat">♻️ تصفير</button>
        <button class="btn" id="cancelPlat">إغلاق</button>
      </div>
      <span style="font-size:12.5px;color:#6b7">يُحفظ تحت المفتاح platforms_custom_v1</span>
    </footer>
  </div>
</div>

<!-- مودال المبادرات -->
<div class="modal-back" id="initModalBack" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="initModalTitle">
    <header><h3 id="initModalTitle">تحرير قائمة المبادرات</h3><span class="kbd">PIN</span> ١٤٤٧</header>
    <div class="body">
      <p style="margin:4px 0 8px;color:#456;font-size:13px">صيغة JSON: <b>title</b>, <b>url</b>, <b>note</b>.</p>
      <textarea id="initEditor" style="width:100%;min-height:340px;border:1px solid var(--line);border-radius:10px;padding:10px;font-family:ui-monospace,mono;font-size:13px"></textarea>
    </div>
    <footer>
      <div class="row">
        <button class="btn" id="saveInit">💾 حفظ</button>
        <button class="btn" id="resetInit">♻️ تصفير</button>
        <button class="btn" id="cancelInit">إغلاق</button>
      </div>
      <span style="font-size:12.5px;color:#6b7">يُحفظ تحت المفتاح initiatives_custom_v1</span>
    </footer>
  </div>
</div>

<script>
/* ================= مفاتيح التخزين ================= */
const ADMIN_PIN = "0000";
const KEY_DOCS = "docs_custom_v1";
const KEY_PLAT = "platforms_custom_v1";
const KEY_INIT = "initiatives_custom_v1";

/* ================= المنصات (كما زودتني + محسّنة) ================= */
const PLATFORMS_DEFAULT = [
  {name:"الدعم الموحّد (IAM)", desc:"نظام النفاذ الموحّد لبوابات وزارة التعليم", url:"https://iam.moe.gov.sa/", tags:["وزارة","دخول"]},
  {name:"مدرستي", desc:"منصة المدرسة للتعليم الإلكتروني", url:"https://schools.madrasati.sa/", tags:["تعلم"]},
  {name:"نور", desc:"نظام إدارة معلومات الطالب", url:"https://noor.moe.gov.sa/Noor/login.aspx", tags:["وزارة","دخول"]},
  {name:"قناة عين", desc:"البث التعليمي ومكتبة الفيديو", url:"http://www.ientv.edu.sa/", tags:["تعلم"]},
  {name:"حضوري", desc:"إثبات الحضور والانصراف", url:"https://hather-ui.moe.gov.sa/dashboard", tags:["وزارة","دخول"]},
  {name:"فارس", desc:"الخدمة الذاتية لمنسوبي التعليم", url:"https://sshr.moe.gov.sa/", tags:["وزارة","دخول"]},

  {name:"المركز الوطني للمناهج", desc:"المنصة الرسمية للمركز الوطني للمناهج", url:"https://sncc.gov.sa/index_ar.html", tags:["وزارة"]},
  {name:"المركز الوطني للتعليم الإلكتروني", desc:"موقع المركز الوطني للتعليم الإلكتروني", url:"https://nelc.gov.sa/", tags:["تعلم"]},

  {name:"Microsoft Forms", desc:"نماذج واستبانات وأنشطة تقييمية", url:"https://forms.office.com/", tags:["تعلم"]},
  {name:"Microsoft Teams", desc:"اجتماعات ودروس افتراضية", url:"https://teams.microsoft.com/", tags:["تعلم","دخول"]},

  {name:"وزارة التعليم — X", desc:"الحساب الرسمي على منصة X", url:"https://x.com/moe_gov_sa", tags:["وزارة"]},
  {name:"المتحدث الرسمي — X", desc:"الحساب الرسمي للمتحدث باسم وزارة التعليم", url:"https://x.com/spokesp_moe", tags:["وزارة"]},
  {name:"هيئة تقويم التعليم — X", desc:"الحساب الرسمي لهيئة تقويم التعليم والتدريب", url:"https://x.com/EtecKsa", tags:["وزارة"]},

  {name:"تعليم الشرقية — X", desc:"الحساب الرسمي لإدارة تعليم الشرقية", url:"https://x.com/MOE_EPR", tags:["وزارة"]},
  {name:"تعليم الرياض — X", desc:"الحساب الرسمي لإدارة تعليم الرياض", url:"https://x.com/MOE_RYH", tags:["وزارة"]},
  {name:"تعليم مكة — X", desc:"الحساب الرسمي لإدارة تعليم مكة", url:"https://x.com/MOE_MHC", tags:["وزارة"]}
];

/* ================= الأدلّة والأنظمة ================= */
const DOCS_DEFAULT = [
  {title:"الدليل التنظيمي لمدارس التعليم العام", kind:"دليل",
   url:"https://drive.google.com/file/d/1E604s0Wni9ht-UnfaB4ywlN55YyjW9Wj/view?usp=sharing",
   desc:"مرجع يوضّح مهام وصلاحيات المدرسة وهيكلها الإداري."},
  {title:"الدليل الإجرائي لمدارس التعليم العام", kind:"دليل",
   url:"https://drive.google.com/file/d/18rVycmGYJ3vNrUq2hsAbZiDGv9WaZULR/view?usp=sharing",
   desc:"خطوات العمل والإجراءات التفصيلية للمهام المدرسية."},
  {title:"لائحة تقويم الطالب 2025م", kind:"لائحة",
   url:"https://drive.google.com/file/d/1jMcFdltw6SomgRAGyFQFOecvJOqF4m8-/view?usp=sharing",
   desc:"أساليب وأدوات وضوابط التقويم لرفع نواتج التعلّم."},
  {title:"الإجراءات التنفيذية للائحة تقويم الطالب 2025م", kind:"دليل",
   url:"https://drive.google.com/file/d/1L5GiafAgPY0vBSQdea_obk9vKcE-t7JR/view",
   desc:"آليات تطبيق اللائحة داخل المدرسة."},
  {title:"قواعد السلوك والمواظبة 1447هـ", kind:"قواعد",
   url:"https://drive.google.com/file/d/1RYIYPFlAcT9Ya-RnPw3bnpQASVQIz0FX/view",
   desc:"حقوق وواجبات الطالب وضوابط الإجراءات التربوية."},
  {title:"آلية تنفيذ النشاط الطلابي 1447هـ", kind:"آلية",
   url:"https://drive.google.com/file/d/1ak9uHKDbi8cPecgYzV8_cIqv2-NlmOR_/view",
   desc:"تفعيل البرامج وفق دليل الخطط الدراسية."},
  {title:"الدليل الاسترشادي لمشرف دعم التميز", kind:"دليل",
   url:"https://drive.google.com/file/d/17l_qlhdWdUBRWEbDcFKT0iCkUh2gifu4/view?usp=sharing",
   desc:"تمكين المشرف من دعم التميز والجودة."},
  {title:"توزيع درجات الطلاب 2025م", kind:"لائحة",
   url:"https://drive.google.com/file/d/1aJfnmDnFuvE5STTsZ6PIGeMJLfYG0Xcl/view?usp=sharing",
   desc:"آلية احتساب الدرجات بين الاختبارات وأعمال الفصل."},
  {title:"دليل العمل التطوعي", kind:"دليل",
   url:"https://drive.google.com/file/d/1MBrdcVABkZajfh97JS1Csv7juRwuvsM9/view?usp=sharing",
   desc:"تنظيم مشاركة الطلاب في التطوع ودعم رؤية 2030."},
  {title:"دليل الاختبارات 2025م", kind:"دليل",
   url:"https://drive.google.com/file/d/1igqY7tNeqoEPX7YV6VqTw0GnGUWDzBNf/view?usp=sharing",
   desc:"الأسس الفنية والتنظيمية لتنفيذ الاختبارات."},
  {title:"دليل خدمة الجدول المدرسي 2025م", kind:"دليل",
   url:"https://drive.google.com/file/d/1XAMG04koxiH2pd8jfVwgFTYKvGX_JqHf/view?usp=sharing",
   desc:"إعداد وإدارة الجداول إلكترونيًا."},
  {title:"دليل الزي المدرسي والرياضي لطلبة التعليم العام", kind:"دليل",
   url:"https://drive.google.com/file/d/1dJaj5cH6sUOpUh2shay36xH7FctVxZXh/view?usp=sharing",
   desc:"المواصفات المعتمدة للزي بما يعزز الهوية والانضباط."},
  {title:"دليل السلوك المهني لموظفي وزارة التعليم 2025", kind:"دليل",
   url:"https://drive.google.com/file/d/1FP2_l_4vTqbuBK7k03YktLX92TVdqDcy/view?usp=sharing",
   desc:"القيم والمعايير المهنية لمنسوبي التعليم."},
  {title:"استمارة الزيارة الفني لمشرف الإدارة المدرسية", kind:"نموذج",
   url:"https://drive.google.com/file/d/1Q2SnbnnteJCIgyz8WZCESV01Jk_3rPMh/view?usp=sharing",
   desc:"نموذج توثيق الزيارة: معايير، مؤشرات، وتوصيات."}
];

/* ===== المبادرات (كما هي) ===== */
const INITIATIVES_DEFAULT = [
  {title:"استمارة دعم وتطوير الهيئة التعليمية", url:"https://fhz545-hub.github.io/teachervisit/", note:"توثيق الزيارات الصفّية ونقاط التحسين."},
  {title:"الشؤون الإدارية والمتابعة", url:"https://fhz545-hub.github.io/teacher-eval-1447/", note:"متابعة الانضباط والزيارات الإشرافية."},
  {title:"نموذج تقييم الأداء الوظيفي", url:"https://fhz545-hub.github.io/taqyeem/", note:"التخطيط والمراجعة النصفية والتقييم النهائي."},
  {title:"جدول المدرسة اللحظي", url:"https://fhz545-hub.github.io/jadwal-live/", note:"جداول ومواعيد وتكليفات لحظية."},
  {title:"نموذج تصميم وتنفيذ برنامج/نشاط", url:"https://fhz545-hub.github.io/Report/", note:"خطوات التصميم والتوثيق بالأثر."}
];

/* ============ تحميل الحالة من التخزين المحلي ============ */
let PLATFORMS = JSON.parse(localStorage.getItem(KEY_PLAT) || 'null') || PLATFORMS_DEFAULT;
let DOCS = JSON.parse(localStorage.getItem(KEY_DOCS) || 'null') || DOCS_DEFAULT;
let INITIATIVES = JSON.parse(localStorage.getItem(KEY_INIT) || 'null') || INITIATIVES_DEFAULT;

/* ===== تبويب الأقسام والتنقل السريع ===== */
const tabs = [...document.querySelectorAll('.tab')];
tabs.forEach(t=>t.addEventListener('click',()=>{
  tabs.forEach(x=>x.classList.remove('active')); t.classList.add('active');
  const target = document.querySelector(t.dataset.target);
  if(target) target.scrollIntoView({behavior:'smooth',block:'start'});
}));

/* ===== بحث عام (يؤثر على المنصات والأدلّة والمبادرات) مع Debounce ===== */
const globalSearch = document.getElementById('globalSearch');
let debounceT;
function debounce(fn,ms){return (...a)=>{clearTimeout(debounceT);debounceT=setTimeout(()=>fn(...a),ms)}}

/* ============ توليد واجهة المنصات ============ */
const grid = document.getElementById('platformGrid');
const countP = document.getElementById('countP');
const searchPlat = document.getElementById('platformSearch');
const filterChips = [...document.querySelectorAll('.chip')];

function renderPlatforms(){
  const q= (searchPlat.value || globalSearch.value || "").trim().toLowerCase();
  const active=filterChips.find(c=>c.classList.contains('active'))?.dataset.filter||'all';
  grid.innerHTML=''; let shown=0;
  PLATFORMS.forEach(p=>{
    const okFilter=(active==='all')||(p.tags||[]).includes(active);
    const okSearch=!q||p.name.toLowerCase().includes(q)||(p.desc||'').toLowerCase().includes(q);
    if(okFilter && okSearch){
      shown++;
      grid.insertAdjacentHTML('beforeend',`
        <a class="card linkcard" href="${p.url}" target="_blank" rel="noopener" data-tags="${(p.tags||[]).join(',')}">
          <div class="title">${p.name}</div>
          <div class="desc">${p.desc||''}</div>
          <div class="badges">${(p.tags||[]).map(t=>`<span class="badge">${t}</span>`).join('')}</div>
        </a>
      `);
    }
  });
  countP.textContent = shown? `${shown}`: '';
}
filterChips.forEach(c=>c.addEventListener('click',()=>{filterChips.forEach(x=>x.classList.remove('active'));c.classList.add('active');renderPlatforms();}));
searchPlat.addEventListener('input',debounce(renderPlatforms,160));
globalSearch.addEventListener('input',debounce(()=>{renderPlatforms(); renderDocs(); renderInitiatives();},180));
renderPlatforms();

/* ============ المبادرات ============ */
const initList=document.getElementById('initList');
const countI=document.getElementById('countI');
function renderInitiatives(){
  const q=(globalSearch.value||"").trim().toLowerCase();
  initList.innerHTML=''; let shown=0;
  INITIATIVES.forEach(it=>{
    const ok=!q || it.title.toLowerCase().includes(q) || (it.note||'').toLowerCase().includes(q);
    if(!ok) return; shown++;
    initList.insertAdjacentHTML('beforeend',`
      <a class="card linkcard" href="${it.url}" target="_blank" rel="noopener">
        <div class="title">${it.title}</div>
        <div class="desc">${it.note||''}</div>
      </a>
    `);
  });
  countI.textContent = shown? `${shown}`: '';
}
renderInitiatives();

/* ============ الأدلّة: عرض + تحميل مباشر ============ */
const docsCols=document.getElementById('docsCols');
const countD=document.getElementById('countD');
function linkFor(d){return d.fileDataUrl?d.fileDataUrl:(d.url||"#");}
function driveDirectDownload(u){try{const m=u.match(/drive\.google\.com\/file\/d\/([^/]+)\//i);return(m&&m[1])?`https://drive.google.com/uc?export=download&id=${m[1]}`:u;}catch{return u;}}
function safeName(t){return (t||'document').replace(/[\\/:*?"<>|]+/g,' ').trim()+'.pdf';}

function renderDocs(){
  const q=(globalSearch.value||"").trim().toLowerCase();
  docsCols.innerHTML='';
  const cols=[document.createElement('div'),document.createElement('div'),document.createElement('div')];
  let shown=0; let i=0;
  DOCS.forEach(d=>{
    const ok=!q || (d.title||'').toLowerCase().includes(q) || (d.desc||'').toLowerCase().includes(q) || (d.kind||'').toLowerCase().includes(q);
    if(!ok) return; shown++;
    const openHref=linkFor(d);
    const dlHref=d.fileDataUrl?d.fileDataUrl:driveDirectDownload(d.url||'#');
    const card=`
      <article class="card" style="grid-template-columns:1fr auto">
        <div>
          <div class="title">${d.title}</div>
          <div class="desc">${d.desc||''}</div>
          <div class="badges"><span class="badge">${d.kind||"دليل"}</span></div>
        </div>
        <div class="actions">
          <a class="btn open" href="${openHref}" target="_blank" rel="noopener" title="فتح في تبويب جديد">🔗 فتح</a>
          <a class="btn download" href="${dlHref}" download="${safeName(d.title)}" title="تنزيل الملف">⬇️ تحميل</a>
        </div>
      </article>`;
    cols[i%3].insertAdjacentHTML('beforeend',card); i++;
  });
  cols.forEach(c=>docsCols.appendChild(c));
  countD.textContent = shown? `${shown}`: '';
}
renderDocs();

/* ============ إدارة الأدلّة (PIN ١٤٤٧) ============ */
const Mback=document.getElementById('docsModalBack');
const btnManage=document.getElementById('btnManageDocs');
const listAdmin=document.getElementById('docsListAdmin');
const fTitle=document.getElementById('docTitle');
const fKind=document.getElementById('docKind');
const fUrl=document.getElementById('docUrl');
const fFile=document.getElementById('docFile');
const fDesc=document.getElementById('docDesc');
const btnAdd=document.getElementById('addDoc');
const btnSave=document.getElementById('saveDoc');
const btnCancel=document.getElementById('cancelDoc');
const btnReset=document.getElementById('resetDocs');
let editIndex=-1;

function adminList(){
  listAdmin.innerHTML=DOCS.map((d,i)=>`
    <div class="card" style="grid-template-columns:1fr auto;align-items:center">
      <div>
        <div class="title">${d.title}</div>
        <div class="desc" style="margin-top:3px">${d.desc||''}</div>
        <div class="badges" style="margin-top:6px">
          <span class="badge">${d.kind||"دليل"}</span>
          ${d.fileDataUrl?`<span class="badge">PDF محلي</span>`:''}
          ${d.url?`<span class="badge">رابط خارجي</span>`:''}
        </div>
      </div>
      <div class="actions">
        <button class="btn" onclick="editDoc(${i})">تعديل</button>
        <button class="btn" onclick="delDoc(${i})">حذف</button>
      </div>
    </div>`).join('');
}
function openDocsModal(){
  const ok=sessionStorage.getItem('docs_admin_ok')==='1'||prompt('أدخل رمز الإدارة (PIN)')===ADMIN_PIN;
  if(!ok) return;
  sessionStorage.setItem('docs_admin_ok','1');
  adminList();
  fTitle.value=fKind.value=fUrl.value=fDesc.value=''; fFile.value=''; editIndex=-1;
  Mback.style.display='grid';
}
function closeDocsModal(){Mback.style.display='none';}
btnManage.addEventListener('click',openDocsModal);
btnCancel.addEventListener('click',closeDocsModal);
btnAdd.addEventListener('click',()=>{editIndex=-1;fTitle.value='';fKind.value='دليل';fUrl.value='';fFile.value='';fDesc.value='';});
btnSave.addEventListener('click',async()=>{
  const item={title:fTitle.value.trim(),kind:fKind.value,url:fUrl.value.trim(),desc:fDesc.value.trim()};
  if(!item.title){alert('العنوان مطلوب');return;}
  if(fFile.files&&fFile.files[0]){
    const file=fFile.files[0];
    if(file.type!=='application/pdf'){alert('الرجاء رفع PDF فقط');return;}
    item.fileDataUrl=await fileToDataUrl(file);
  }
  if(editIndex>=0){DOCS[editIndex]={...DOCS[editIndex],...item};}
  else{DOCS.push(item);}  
  localStorage.setItem(KEY_DOCS,JSON.stringify(DOCS));
  renderDocs();adminList();
  fTitle.value=fKind.value=fUrl.value=fDesc.value='';fFile.value='';
});
btnReset.addEventListener('click',()=>{
  if(confirm('تأكيد تصفير الأدلّة؟')){localStorage.removeItem(KEY_DOCS);DOCS=[...DOCS_DEFAULT];renderDocs();adminList();}
});
window.editDoc=(i)=>{editIndex=i;const d=DOCS[i];fTitle.value=d.title||'';fKind.value=d.kind||'دليل';fUrl.value=d.url||'';fDesc.value=d.desc||'';fFile.value='';document.querySelector('#docsModalBack .body').scrollTop=0;}
window.delDoc=(i)=>{if(!confirm('حذف هذا الدليل؟'))return;DOCS.splice(i,1);localStorage.setItem(KEY_DOCS,JSON.stringify(DOCS));renderDocs();adminList();}
function fileToDataUrl(file){return new Promise((res,rej)=>{const r=new FileReader();r.onload=()=>res(r.result);r.onerror=rej;r.readAsDataURL(file);});}

/* ============ إدارة المنصات (PIN) ============ */
const Pback=document.getElementById('platModalBack');
const btnPlat=document.getElementById('btnEditPlatforms');
const txtPlat=document.getElementById('platEditor');
const btnSavePlat=document.getElementById('savePlat');
const btnResetPlat=document.getElementById('resetPlat');
const btnCancelPlat=document.getElementById('cancelPlat');

function openPlatModal(){
  const ok=sessionStorage.getItem('plat_admin_ok')==='1'||prompt('أدخل رمز الإدارة (PIN)')===ADMIN_PIN;
  if(!ok)return;
  sessionStorage.setItem('plat_admin_ok','1');
  txtPlat.value=JSON.stringify(PLATFORMS,null,2);
  Pback.style.display='grid';
}
btnPlat.addEventListener('click',openPlatModal);
btnCancelPlat.addEventListener('click',()=>Pback.style.display='none');
btnResetPlat.addEventListener('click',()=>{
  if(confirm('إرجاع قائمة المنصات للوضع المبدئي؟')){
    PLATFORMS=[...PLATFORMS_DEFAULT];
    localStorage.removeItem(KEY_PLAT);
    renderPlatforms();
    txtPlat.value=JSON.stringify(PLATFORMS,null,2);
  }
});
btnSavePlat.addEventListener('click',()=>{
  try{
    const parsed=JSON.parse(txtPlat.value);
    if(!Array.isArray(parsed)) throw new Error('يجب أن تكون مصفوفة عناصر');
    PLATFORMS=parsed; localStorage.setItem(KEY_PLAT,JSON.stringify(PLATFORMS));
    renderPlatforms(); Pback.style.display='none';
  }catch(e){alert('JSON غير صالح:\n'+e.message);}
});

/* ============ إدارة المبادرات (PIN) ============ */
const Iback=document.getElementById('initModalBack');
const btnInit=document.getElementById('btnEditInit');
const txtInit=document.getElementById('initEditor');
const btnSaveInit=document.getElementById('saveInit');
const btnResetInit=document.getElementById('resetInit');
const btnCancelInit=document.getElementById('cancelInit');

function openInitModal(){
  const ok=sessionStorage.getItem('init_admin_ok')==='1'||prompt('أدخل رمز الإدارة (PIN)')===ADMIN_PIN;
  if(!ok)return;
  sessionStorage.setItem('init_admin_ok','1');
  txtInit.value=JSON.stringify(INITIATIVES,null,2);
  Iback.style.display='grid';
}
btnInit.addEventListener('click',openInitModal);
btnCancelInit.addEventListener('click',()=>Iback.style.display='none');
btnResetInit.addEventListener('click',()=>{
  if(confirm('إرجاع قائمة المبادرات للوضع المبدئي؟')){
    INITIATIVES=[...INITIATIVES_DEFAULT]; localStorage.removeItem(KEY_INIT);
    renderInitiatives(); txtInit.value=JSON.stringify(INITIATIVES,null,2);
  }
});
btnSaveInit.addEventListener('click',()=>{
  try{
    const parsed=JSON.parse(txtInit.value);
    if(!Array.isArray(parsed)) throw new Error('يجب أن تكون مصفوفة عناصر');
    parsed.forEach((it,i)=>{if(!it.title||!it.url) throw new Error(`عنصر #${i+1}: title و url مطلوبة`);});
    INITIATIVES=parsed; localStorage.setItem(KEY_INIT,JSON.stringify(INITIATIVES));
    renderInitiatives(); Iback.style.display='none';
  }catch(e){alert('JSON غير صالح:\n'+e.message);}  
});

/* إغلاق المودالات بالنقر خارجها أو Esc */
document.querySelectorAll('.modal-back').forEach(back=>{
  back.addEventListener('click',(e)=>{if(e.target===back) back.style.display='none';});
});
document.addEventListener('keydown',(e)=>{if(e.key==='Escape'){document.querySelectorAll('.modal-back').forEach(back=>back.style.display='none');}});

/* أزرار الشريط الجانبي */
document.getElementById('goTop').onclick=()=>window.scrollTo({top:0,behavior:'smooth'});
document.getElementById('goPlat').onclick=()=>document.getElementById('btnEditPlatforms').click();
document.getElementById('goInit').onclick=()=>document.getElementById('btnEditInit').click();
document.getElementById('goDocs').onclick=()=>document.getElementById('btnManageDocs').click();
</script>
</body>
</html>
